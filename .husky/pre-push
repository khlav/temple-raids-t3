echo "ğŸš€ Running pre-push checks..."

# Task 0: Validate branch name
echo "0/4 ğŸŒ¿ Validating branch name..."
current_branch=$(git branch --show-current)
if echo "$current_branch" | grep -qE '^(feature|fix|chore|refactor|hotfix|dev)/.+'; then
  echo "0/4 âœ… Branch name follows convention: $current_branch"
else
  echo "0/4 âŒ Branch name does not follow convention: $current_branch"
  echo "   Expected format: {type}/{description}"
  echo "   Types: feature, fix, chore, refactor, hotfix, dev"
  echo "   Example: feature/add-search-functionality"
  exit 1
fi

# Task 1: Linting
echo "1/4 âš¡ Linting codebase..."
if pnpm lint > /dev/null 2>&1; then
  echo "1/4 âœ… Linting passed"
else
  echo "1/4 âŒ Linting failed"
  echo "Running lint to show errors:"
  pnpm lint
  exit 1
fi

# Task 2: Type checking
echo "2/4 ğŸ” Type checking..."
if pnpm typecheck > /dev/null 2>&1; then
  echo "2/4 âœ… Type checking passed"
else
  echo "2/4 âŒ Type checking failed"
  echo "Running typecheck to show errors:"
  pnpm typecheck
  exit 1
fi

# Task 3: Building
echo "3/4 ğŸ”¨ Building application..."
if npx next build > /dev/null 2>&1; then
  echo "3/4 âœ… Build passed"
else
  echo "3/4 âŒ Build failed"
  echo "Running build to show errors:"
  npx next build
  exit 1
fi

# Task 4: Final validation
echo "4/4 ğŸ” Final validation..."
# Check for any remaining console.log statements
if find src -name "*.ts" -o -name "*.tsx" | xargs grep -l "console\.log" 2>/dev/null; then
  echo "4/4 âš ï¸  Warning: console.log statements found in codebase"
  echo "   Consider removing or replacing with proper logging"
fi

echo "4/4 âœ… All pre-push checks completed successfully!"
echo "ğŸ‰ Ready to push!"
