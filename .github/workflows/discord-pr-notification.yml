name: Discord PR Notification

on:
  pull_request:
    types: [closed]

jobs:
  notify-discord:
    if: |
      github.event.pull_request.merged == true &&
      contains(github.event.pull_request.labels.*.name, 'user-facing')
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Send Discord Notification
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          chmod +x .github/scripts/discord-notify.sh
          .github/scripts/discord-notify.sh \
            "${{ github.event.pull_request.number }}" \
            "${{ github.event.pull_request.title }}" \
            "${{ github.event.pull_request.body }}" \
            "${{ github.event.pull_request.html_url }}" \
            "${{ github.event.pull_request.merged_at }}"
