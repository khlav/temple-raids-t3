# Cursor Rules for Temple Raids T3

## CRITICAL: Codebase Familiarization & Documentation

**MANDATORY RULES - ALWAYS APPLY:**

1. **When familiarizing with the codebase**, you MUST:
   - **ALWAYS read `CLAUDE.md` first** before exploring the codebase
   - Use `CLAUDE.md` as the primary reference for architecture, patterns, and workflows
   - Reference `CLAUDE.md` when answering questions about project structure, development commands, or architectural decisions

2. **When making repository updates**, you MUST:
   - **Update `CLAUDE.md`** to reflect any changes to:
     - Architecture or tech stack
     - Project structure or file organization
     - Development commands or workflows
     - Database schema or patterns
     - API endpoints or integrations
     - Common patterns or best practices
   - Keep `CLAUDE.md` synchronized with the actual codebase state
   - Treat `CLAUDE.md` as living documentation that must be maintained

3. **These rules apply to ALL interactions** - no exceptions. Always check and update `CLAUDE.md` as part of your workflow.

## PR Generation Rules

### 1. Always Return Clickable Links
When generating or referencing PRs, always provide clickable links in the format:
- `[PR #123: Title](https://github.com/khlav/temple-raids-t3/pull/123)`
- Use full GitHub URLs for maximum compatibility

### 2. Branch Management Rules
**CRITICAL**: All development work MUST be done on non-main branches. Never commit directly to `main`.

#### Pre-flight Checks
- **Verify working tree**: Run `git status` to confirm there are changes to commit
- **Check current branch**: If on `main`, create new branch; if on feature branch, use existing branch
- **Validate changes**: Ensure all changes are ready and tested

#### Branch Creation Rules
- **Always create feature branches** for any changes, no matter how small
- **Never work directly on main** - main is for stable, merged code only
- **Use descriptive branch names** following the naming convention below

### 3. "Ship It" Command Behavior
**CRITICAL**: When the user says "ship it", you MUST follow these exact steps in order. Do not use your own "ship it" logic - follow these rules precisely:

#### Step-by-Step Process
0. **Before shipping, ensure `CLAUDE.md` is up to date**:
   - If changes affect architecture, structure, commands, or patterns, update `CLAUDE.md` first
   - Commit `CLAUDE.md` updates as part of the same PR

1. **Create branch** (if on main): Use format `{type}/{kebab-case-description}` where type is:
   - `feature/` - New user-facing functionality
   - `fix/` - Bug fixes or corrections  
   - `chore/` - Maintenance, dependencies, tooling
   - `refactor/` - Code improvements without behavior changes
   - `hotfix/` - Critical production fixes
   - `dev/` - Developer-only changes (docs, config, CI, developer workflow)

2. **Commit changes**: 
   - Stage all files: `git add .`
   - Commit with conventional format: `{type}({scope}): {description}`
   - Examples: `feat(search): add advanced filtering`, `fix(ui): resolve layout issue`

3. **Push branch**: `git push origin {branch-name}`

4. **Create PR**:
   - Use `gh pr create` with title and description
   - Title format: `{Action} {what was changed}`
   - Description: **Always use** `.github/pull_request_template.md` if it exists
   - Fill out all required sections in the template
   - If no template exists, use standard format with key changes and technical context

5. **Apply user-facing label**:
   - **Always apply** for `feature/` and `fix/` branches (unless only config files changed)
   - **Never apply** for `chore/`, `dev/`, `refactor/` branches
   - **Config-only check**: If changes are ONLY in `.github/`, `.cursorrules`, `*.config.*`, `*.yml`, `*.yaml`, `README.md`, `package.json`, `pnpm-lock.yaml` â†’ skip label
   - Use: `gh pr create --label "user-facing"` when applying

6. **Return clickable link**: Always provide the clickable PR link in format `[PR #123: Title](https://github.com/khlav/temple-raids-t3/pull/123)`

#### Error Handling
- If any step fails, stop and report the error
- Do not proceed with subsequent steps if previous steps failed
- Provide clear error messages for debugging

#### Important Notes
- Only ship changes that are currently ready - do not assume future changes
- The `user-facing` label controls Discord notifications for merged PRs
- Label can be manually adjusted after PR creation if auto-detection is incorrect

### 4. PR Description Formatting
When creating PR descriptions, ensure proper escaping for code blocks and special characters:

**For inline code references**: Use *italics* instead of backticks for better readability
- Example: Use *functionName* instead of `functionName`
- Example: Use *variableName* instead of `variableName`
- Example: Use *onConflictDoUpdate* instead of `onConflictDoUpdate`

**For code blocks**: Use triple backticks with language specification
- Example: 
  ```
  \`\`\`typescript
  const example = "properly escaped";
  \`\`\`
  ```

**For special characters**: Escape as needed for GitHub markdown
- `*` becomes `\*` when not used for emphasis
- `_` becomes `\_` when not used for emphasis
- `#` becomes `\#` when not used for headers

**Zone acronyms and technical terms**: Use *italics* for better readability
- Example: *MC*, *BWL*, *AQ40*, *Naxx* for zone acronyms
- Example: *warriors OR mages* for search syntax

### 5. Branch Naming Convention
- `feature/description` for new features
- `fix/description` for bug fixes
- `chore/description` for maintenance tasks
- `refactor/description` for code refactoring
- Use kebab-case for multi-word descriptions

### 6. Commit Message Format
- Use conventional commits format: `type(scope): description`
- Examples:
  - `feat(search): add advanced search syntax`
  - `fix(ui): resolve sidebar navigation issue`
  - `chore(deps): update dependencies`

### 7. PR Title Format
- Start with action verb: "Add", "Fix", "Update", "Refactor"
- Be descriptive but concise
- Include scope if relevant: "Add advanced search functionality"

### 8. PR Description Standards
- **Follow the PR template** - Always use `.github/pull_request_template.md` if it exists
- **Be crisp and concise** - Keep descriptions brief and to the point
- **Focus on key changes** - What was added, fixed, or improved (2-4 bullet points max)
- **Use bullet points** for easy scanning (limit to essential items only)
- **Include technical context** only when necessary for understanding (avoid implementation details unless critical)
- **Template compliance** - Fill out all required sections in the template, but keep each section brief
- **Custom sections** - Add any additional context in appropriate template sections, but be brief
- **Avoid repetition** - Don't restate what's already clear from the title or commit message
- **User-focused** - Prioritize what users will see/experience over technical implementation details

## Code Quality Rules

### TypeScript/React Standards
- Use TypeScript strict mode
- Prefer functional components with hooks
- Use proper type definitions
- Follow the existing codebase patterns

### Database/API Standards
- Use Drizzle ORM patterns consistently
- Follow tRPC router conventions
- Implement proper error handling
- Use Zod for validation

### UI/UX Standards
- Use Tailwind CSS classes consistently
- Follow the existing component library patterns
- Ensure responsive design
- Maintain accessibility standards
